<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gesti√≥n de Clientes</title>
  <style>
  body { font-family: Arial; padding: 20px; background: #f7f7f7; }
  input, textarea, button { margin: 5px 0; display: block; padding: 8px; width: 100%; max-width: 400px; }
  #lista-clientes { display: flex; flex-wrap: wrap; gap: 2%; }
  .cliente { background: #fff; padding: 10px; margin-top: 10px; border: 1px solid #ccc; border-radius: 5px; width: 48%; box-sizing: border-box; }
  .cliente button { width: auto; margin-right: 10px; }
  @media (max-width: 800px) {
    .cliente { width: 100%; }
    #lista-clientes { gap: 0; }
  }
</style>
</head>
<body>
  <h2>Registro de Clientes</h2>
  <input id="nombre" placeholder="Nombre del cliente">
  <input id="celular" placeholder="N√∫mero celular">
  <input id="vehiculo" placeholder="Veh√≠culo de inter√©s">
  <textarea id="comentario" placeholder="Comentario adicional"></textarea>
  <button onclick="agregarCliente()">Agregar Cliente</button>

  <label for="filtro">Filtrar por estado:</label>
  <select id="filtro" onchange="mostrarClientes()">
    <option value="Todos">Todos</option>
    <option value="Pendiente">Pendientes</option>
    <option value="Aceptado">Aprobados</option>
    <option value="Descartado">Descartados</option>
  </select>

  <div id="lista-clientes"></div>
  <script>
    const googleScriptURL = 'https://script.google.com/macros/s/AKfycbwEZbQoK_nNSvqctNqmgaVGl9h2Um__aKuE7pD_EiLzgf-BzOgZnX0tHFylaSx_2SWBZQ/exec';

    let clientes = JSON.parse(localStorage.getItem("clientes") || "[]");
    mostrarClientes();

    function agregarCliente() {
      const nombre = document.getElementById("nombre").value;
      const celular = document.getElementById("celular").value;
      const vehiculo = document.getElementById("vehiculo").value;
      const comentario = document.getElementById("comentario").value;
      const estado = "Pendiente";

      if (!nombre || !celular || !vehiculo) {
        alert("Completa todos los campos obligatorios.");
        return;
      }

      const cliente = { nombre, celular, vehiculo, comentario, estado };
      clientes.push(cliente);
      localStorage.setItem("clientes", JSON.stringify(clientes));
      mostrarClientes();

      // Enviar a Google Sheets
      fetch(googleScriptURL, {
        method: 'POST',
        body: JSON.stringify(cliente),
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(res => res.text())
      .then(resp => console.log('Enviado a Google Sheets:', resp))
      .catch(err => console.error('Error al enviar:', err));

      // Limpiar campos
      document.getElementById("nombre").value = "";
      document.getElementById("celular").value = "";
      document.getElementById("vehiculo").value = "";
      document.getElementById("comentario").value = "";
    }

    let editando = null;

function mostrarClientes() {
  const contenedor = document.getElementById("lista-clientes");
  contenedor.innerHTML = "";
  const filtro = document.getElementById("filtro") ? document.getElementById("filtro").value : "Todos";
  clientes.forEach((c, i) => {
    if (filtro === "Todos" || c.estado === filtro) {
      const div = document.createElement("div");
      div.className = "cliente";
      div.innerHTML = `
        <div><strong>Nombre:</strong> ${c.nombre}</div>
        <div><strong>Celular:</strong> ${c.celular}</div>
        <div><strong>Veh√≠culo:</strong> ${c.vehiculo}</div>
        <div><strong>Comentario:</strong> ${c.comentario || "Sin comentario"}</div>
        <div><strong>Estado:</strong> ${c.estado}</div>
        <div>
          <button onclick="cambiarEstado(${i}, 'Aceptado')">‚úÖ Aceptar</button>
          <button onclick="cambiarEstado(${i}, 'Descartado')">‚ùå Descartar</button>
          <button onclick="eliminarCliente(${i})">üóëÔ∏è Eliminar</button>
          <button onclick="editarCliente(${i})">‚úèÔ∏è Editar</button>
        </div>
      `;
      contenedor.appendChild(div);
    }
  });
}

function editarCliente(index) {
  const c = clientes[index];
  document.getElementById("nombre").value = c.nombre;
  document.getElementById("celular").value = c.celular;
  document.getElementById("vehiculo").value = c.vehiculo;
  document.getElementById("comentario").value = c.comentario;
  editando = index;
  document.querySelector('button[onclick="agregarCliente()"]').textContent = "Guardar Cambios";
}

function agregarCliente() {
  const nombre = document.getElementById("nombre").value;
  const celular = document.getElementById("celular").value;
  const vehiculo = document.getElementById("vehiculo").value;
  const comentario = document.getElementById("comentario").value;
  const estado = "Pendiente";

  if (!nombre || !celular || !vehiculo) {
    alert("Completa todos los campos obligatorios.");
    return;
  }

  if (editando !== null) {
    clientes[editando] = { nombre, celular, vehiculo, comentario, estado: clientes[editando].estado };
    editando = null;
    document.querySelector('button[onclick="agregarCliente()"]').textContent = "Agregar Cliente";
  } else {
    const cliente = { nombre, celular, vehiculo, comentario, estado };
    clientes.push(cliente);
    // Enviar a Google Sheets
    fetch(googleScriptURL, {
      method: 'POST',
      body: JSON.stringify(cliente),
      headers: {
        'Content-Type': 'application/json'
      }
    })
    .then(res => res.text())
    .then(resp => console.log('Enviado a Google Sheets:', resp))
    .catch(err => console.error('Error al enviar:', err));
  }

  localStorage.setItem("clientes", JSON.stringify(clientes));
  mostrarClientes();

  // Limpiar campos
  document.getElementById("nombre").value = "";
  document.getElementById("celular").value = "";
  document.getElementById("vehiculo").value = "";
  document.getElementById("comentario").value = "";
}

function eliminarCliente(index) {
  clientes.splice(index, 1);
  localStorage.setItem("clientes", JSON.stringify(clientes));
  mostrarClientes();
}

    function cambiarEstado(index, nuevoEstado) {
      clientes[index].estado = nuevoEstado;
      localStorage.setItem("clientes", JSON.stringify(clientes));
      mostrarClientes();
    }
  </script>
</body>
</html>


